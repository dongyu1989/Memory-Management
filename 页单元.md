# Memory-Management

硬件的分页单元
------------
分页单元(paging unit)把线性地址转换成物理地址。它把所请求的存取类型和线性地址的存取权限相比，如果这次内存存取是无效的，则产生一个页错误异常。

为了效率起见，线性地址被分成以固定长度为单位的组，称为页。页内连续的线性地址被映射到连续的物理地址中。用这种方式内核可以指定物理地址和页的存取权限，以代替它所包含的全部线性地址的存取权限。

把线性地址映射到物理地址的数据结构称为页表(page table)。页表存放在主存中，并在启动分页单元以前必须由内核对页表进行适当的初始化。

在intel处理器，通过设置cr0寄存器的PG标志启动分页。当PG=0时，线性地址被解释成物理地址。

![image](https://github.com/wangdongyu1989/Memory-Management/blob/master/%E5%86%85%E5%AD%98%E6%98%A0%E5%B0%8420170402a.jpg "分页单元")

32位的线性地址被分成3个域，10位：目录，10位：页表，12位：偏移量。

线性地址的转换分为两步完成，每一步都是基于一种转换表，第一种转换表称为页目录表(page directory)，第二种转换表称为页表(page table)。

使用这两种二级模式的目的在于减少每个进程页表所需RAM的数量。如果使用简单的一级页表，那将需要高达2的20次幂个表象（也就是，在每个4个字节时，需要4MB RAM）来表示每个进程的页表（如果进程使用全部4GB线性地址空间），即使一个进程不使用那个范围内的所有地址。二级模式通过只为进程实际使用的那些虚拟内存区请求页表来减少内存容量。

每个活动进程必须有一个分配给它的页目录。不过，没有必要马上为进程的所有页表都分配RAM。只有在进程实际需要一个页表时才给页表分配RAM会更为有效率。
